import { Layout, Playground, Attributes } from 'lib/components'
import { Table, Spacer, Tooltip, Toggle } from 'components'
import { useState, AllHTMLAttributes } from 'react'

export const meta = {
  title: 'Table',
  group: 'Data Display',
}

## Table

Display tabular data in format.

<Playground
  title="Simple Table"
  scope={{ Table, Spacer }}
  code={`
  () => {
    const columns = [
      { title: 'title1', dataIndex: 'a', key: 'a', width: 100 },
      { id: '123', title: 'title2', dataIndex: 'b', key: 'b', width: 100, align: 'right' },
      { title: 'title3', dataIndex: 'c', key: 'c', width: 200 },
      {
        title: 'Operations',
        dataIndex: '',
        key: 'd',
        render(_, record) {
          return (
            <a
              onClick={e => {
                e.preventDefault();
                console.log('Operate on:', record);
              }}
              href="#"
            >
              Operations
            </a>
          );
        },
      },
    ]
    const data = [
      { a: '123', key: '1' },
      { a: 'cdd', b: 'edd', key: '2' },
      { a: '1333', c: 'eee', d: 2, key: '3' },
    ]
    return (
      <>
        <Table columns={columns} data={data} />
        <Spacer />
        <Table variant='solid' columns={columns} data={data} />
      </>
    )
  }
`}
/>

<Playground
  title="JSX"
  desc="Display formatted data in rows and columns."
  scope={{ Table }}
  code={`
  () => {
    const { Column } = Table
    const data = [
      { a: '123', key: '1' },
      { a: 'cdd', b: 'edd', key: '2' },
      { a: '1333', c: 'eee', d: 2, key: '3' },
    ]
    return (
      <Table variant='line' data={data}>
        <Column title="title1" dataIndex="a" key="a" width={100} />
        <Column title="title2" dataIndex="b" key="b" width={100} />
        <Column title="title3" dataIndex="c" key="c" width={200} />
        <Column title="Operations" dataIndex="" key="d" render={() => <a href="">Operations</a>} />
      </Table>
    )
  }
`}
/>

<Playground
  title="Ellipsis"
  desc="Table content with ellipsis and tooltip"
  scope={{ Table, Tooltip }}
  code={`
  () => {
    const createColumns = (length) => {
      return Array.from({ length }, (_, i) => ({
        title: 'description',
        dataIndex: 'description',
        key: 'description ' +  (i + 1),
        ellipsis: {
          showTitle: false,
        },
        ...(i === 0 ? { width: 50 } : null),
        render(description) {
          return (
            <Tooltip placement="topStart" text={description}>
              <span>{description}</span>
            </Tooltip>
          )
        },
      }))
    }
    const columns = [
      {
        title: 'name',
        dataIndex: 'name',
        width: 100,
        ellipsis: {
          showTitle: false,
        },
        render: (name) => {
        console.log('name', name)
        return (
          <Tooltip placement="topStart" text={name}>
            <span>{name}</span>
          </Tooltip>
        ) },
      },
      ...createColumns(10),
      {
        title: 'Operations',
        key: 'operations',
        ellipsis: {
          showTitle: false,
        },
        render() {
          return (
            <Tooltip placement="topStart" text="Operations">
              <a href="">Operations</a>
            </Tooltip>
          )
        },
      },
    ]
    const data = [
      { name: 'jack', description: 'description description', key: '1' },
      { name: 'jackjackjackjackjackjack', description: 'description description', key: '2' },
      { name: 'jack ma', description: 'description description', key: '3' },
      { name: 'jack nickson', description: 'description description', key: '4' },
    ]
    return (
        <Table columns={columns} data={data} />
    )
  }
`}
/>

<Playground
  title="Group header"
  desc="Table with grouped header"
  scope={{ Table }}
  code={`
  () => {
    const { ColumnGroup, Column } = Table
    const data = [
      { a: '123', key: '1' },
      { a: 'cdd', b: 'edd', key: '2' },
      { a: '1333', c: 'eee', d: 2, key: '3' },
    ]
    return (
      <Table data={data}>
        <ColumnGroup title="Bazinga">
          <Column title="title1" dataIndex="a" key="a" width={100} />
          <Column title="title2" dataIndex="b" key="b" width={100} />
        </ColumnGroup>
        <Column title="title3" dataIndex="c" key="c" width={200} />
        <Column title="Operations" dataIndex="" key="d" render={() => <a href="">Operations</a>} />
      </Table>
    )
  }
`}
/>

<Playground
  title="Expand column, fix columns, fix headers"
  desc="Display formatted data in rows and columns."
  scope={{ Table, Spacer, useState, AllHTMLAttributes, Toggle }}
  code={`
  () => {
    function useCheckbox(defaultChecked = false) {
      const [checked, setChecked] = useState(defaultChecked)
      return [
        checked,
        {
          checked,
          onChange:() => {
            setChecked(!checked)
          },
        },
      ]
    }
    const tableData = [
      { key: 0, a: '123' },
      { key: 1, a: 'cdd', b: 'edd' },
      { key: 2, a: '1333', c: 'eee', d: 2 },
    ]
    for (let i = 0; i < 10; i += 1) {
      const str = '' + i
      const item = {
        key: i * 10 + 99,
        a: str.repeat(3),
        b: str.repeat(5),
        c: str.repeat(7),
        d: i,
      }
      tableData.push(item)
    }
    const [data, setData] = React.useState(tableData)
    const [expandedRowKeys, setExpandedRowKeys] = React.useState([])
    const [expandRowByClick, expandRowByClickProps] = useCheckbox()
    const [fixColumns, fixColumnsProps] = useCheckbox()
    const [scrollX, scrollXProps] = useCheckbox()
    const [fixHeader, fixHeaderProps] = useCheckbox()
    const [expandIconPosition, expandIconPositionProps] = useCheckbox()
    const remove = (index) => {
      const newData = data.slice()
      newData.splice(index, 1)
      setData(newData)
    }
    const renderAction = (o, row, index) => (
      <a onClick={() => remove(index)}>
        Delete
      </a>
    )
    const columns = [
      { title: 'title 1', dataIndex: 'a', key: 'a', width: 100 },
      { title: 'title 2', dataIndex: 'b', key: 'b', width: 100 },
      { title: 'title 3', dataIndex: 'c', key: 'c', width: 200 },
      { title: 'Operation', dataIndex: '', key: 'x', render: renderAction },
    ]
    if (fixColumns) {
      columns.unshift({ title: 'fix left 2', dataIndex: 'a', width: 100, fixed: 'left' })
      columns.unshift({ title: 'fix left 1', dataIndex: 'a', width: 100, fixed: true })
      columns.push({ title: 'fix right', dataIndex: 'a', width: 100, fixed: 'right' })
    }
    const onExpand = (expanded, record) => {
      console.log('onExpand', expanded, record)
    }
    const onExpandedRowsChange = (rows) => {
      setExpandedRowKeys(rows)
    }
    const rowExpandable = (record) => record.key !== 1
    // Toggle Button
    let toggleButton
    if (expandedRowKeys.length) {
      const closeAll = () => setExpandedRowKeys([])
      toggleButton = (
        <button type="button" onClick={closeAll}>
          Close All
        </button>
      )
    } else {
      const openAll = () => setExpandedRowKeys([0, 1, 2])
      toggleButton = (<button type="button" onClick={openAll}> Expand All </button>)
    }
    const ToggleLabel = ({ label, ...props }) => (
        <label style={{display: 'flex', alignItems: 'center'}}>
          <Toggle {...props} /> {label}
        </label>
    )
    // Render
    return (
      <div>
        {toggleButton}
        <ToggleLabel label='Expand Row by Click' {...expandRowByClickProps} />
        <ToggleLabel label='Fix Columns' {...fixColumnsProps} />
        <ToggleLabel label='ScrollX' {...scrollXProps} />
        <ToggleLabel label='Fix Header' {...fixHeaderProps} />
        <ToggleLabel label='Change Expand Icon Position' {...expandIconPositionProps} />
        <Spacer />
        <Table
          columns={columns}
          expandable={{
            expandRowByClick,
            expandedRowRender: (record, index, indent, expanded) =>
              expanded ? <p>extra: {record.a}</p> : null,
            expandedRowKeys,
            onExpandedRowsChange,
            onExpand,
            rowExpandable,
            expandIconColumnIndex: expandIconPosition ? 1 : null,
          }}
          scroll={{ x: fixColumns || scrollX ? 2000 : null, y: fixHeader ? 300 : null }}
          data={data}
        />
        <Spacer />
        <Table
          variant='solid'
          columns={columns}
          expandable={{
            expandRowByClick,
            expandedRowRender: (record, index, indent, expanded) =>
              expanded ? <p>extra: {record.a}</p> : null,
            expandedRowKeys,
            onExpandedRowsChange,
            onExpand,
            rowExpandable,
            expandIconColumnIndex: expandIconPosition ? 1 : null,
          }}
          scroll={{ x: fixColumns || scrollX ? 2000 : null, y: fixHeader ? 300 : null }}
          data={data}
        />
      </div>
    )
  }
`}
/>

<Playground
  title="No data"
  desc="Empty data place holder"
  scope={{ Table, Spacer }}
  code={`
  () => {
    const columns = [
      { title: 'title1', dataIndex: 'a', key: 'a', width: 100 },
      { id: '123', title: 'title2', dataIndex: 'b', key: 'b', width: 100 },
      { title: 'title3', dataIndex: 'c', key: 'c', width: 200 },
      {
        title: 'Operations',
        dataIndex: '',
        key: 'd',
        render() {
          return <a href="#">Operations</a>
        },
      },
    ]
    const data = []
    return (
      <>
        <Table columns={columns} data={data} />
        <Spacer />
        <Table columns={columns} data={data} emptyText="customize!!" />
        <Spacer />
        <Table columns={columns} data={data} emptyText={() => <h1>No No No!</h1>} />
      </>
    )
  }
`}
/>

<Attributes edit="/pages/en-us/components/table.mdx">
<Attributes.Title>Table.Props</Attributes.Title>

| Attribute     | Description                                  | Type                                                 | Accepted values                  | Default |
| ------------- | -------------------------------------------- | ---------------------------------------------------- | -------------------------------- | ------- |
| **data**      | data source                                  | `Array<any>`                                         | -                                | -       |
| **emptyText** | displayed text when table's content is empty | `string`                                             | -                                | -       |
| **hover**     | table's hover effect                         | `boolean`                                            | -                                | `true`  |
| **onRow**     | callback row's content by click              | `(row: any, index: number) => void`                  | -                                | -       |
| **onCell**    | callback cell's content by click             | `(cell: any, index: number, colunm: number) => void` | -                                | -       |
| **onChange**  | data change event                            | `(data: any) => void`                                | -                                | -       |
| ...           | native props                                 | `TableHTMLAttributes`                                | `'id', 'name', 'className', ...` | -       |

<Attributes.Title>Table.Column.Props</Attributes.Title>

| Attribute          | Description          | Type     | Accepted values | Default |
| ------------------ | -------------------- | -------- | --------------- | ------- |
| **prop**(required) | table-column's prop  | `string` | -               | -       |
| **label**          | table-column's label | `string` | -               | -       |
| **width**          | width number (px)    | `number` | -               | -       |

</Attributes>

export default ({ children }) => <Layout meta={meta}>{children}</Layout>
